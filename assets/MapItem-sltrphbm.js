import{d as T,u as x,r as m,c as H,w as j,o as Q,a as c,f as E,j as d,b as e,t as l,F as R,g as F,l as D,x as O,i as N,_ as Y,h as S,y as U,z as X,e as q}from"./index-BOz5cyXt.js";const J="/map.webp",W={key:0,class:"loading"},Z={key:1,class:"error"},ee={key:2,class:"artwork-content"},te={class:"artwork-image"},oe=["src","alt"],se={key:0,class:"image-toggle-controls"},ae={key:1,class:"single-view-label"},le={class:"artwork-info"},ie={class:"artwork-title"},ne={class:"artwork-meta"},re={class:"meta-item"},ce={class:"meta-label"},de={class:"meta-value"},ue={class:"meta-item"},ge={class:"meta-label"},ve={class:"meta-value"},ke={class:"artwork-description"},we={class:"description-content"},me={key:0,class:"multiple-artwork-info"},pe={class:"info-text"},he=T({__name:"ArtworkModal",props:{isVisible:{type:Boolean,default:!1},artworkId:{default:""}},emits:["close"],setup(z,{emit:M}){const{locale:u}=x(),g=z,w=M,r=m(null),p=m(!1),$=m(""),h=m(!1),_=m(!1),f=m(!1),P=async o=>{try{const[n,C]=await Promise.all([fetch(`/locales/${o}/common.json`),fetch(`/locales/${o}/artwork.json`)]);if(n.ok&&C.ok){const[a,v]=await Promise.all([n.json(),C.json()]);N.global.setLocaleMessage(o,{...N.global.getLocaleMessage(o),common:a,artwork:v})}}catch(n){console.error("Failed to load locale messages:",n)}},I=H(()=>String(g.artworkId).includes("&")),t=o=>`/artworks/${String(o).split("&")[0].padStart(2,"0")}.webp`,s=o=>`/photos/${String(o).split("&")[0].padStart(2,"0")}.webp`,i=async o=>{try{const a=`/photos/${String(o).split("&")[0].padStart(2,"0")}.webp`;console.log(`Checking photo existence: ${a}`);const v=new Image,k=new Promise(B=>{v.onload=()=>{console.log(`Photo ${a} loaded successfully`),B(!0)},v.onerror=()=>{console.log(`Photo ${a} failed to load`),B(!1)},setTimeout(()=>{console.log(`Photo ${a} load timeout`),B(!1)},3e3)});v.src=a;const y=await k;return console.log(`Photo ${a} check result: exists=${y}`),y}catch(n){return console.log(`Error checking photo for ID ${o}:`,n),!1}},b=H(()=>r.value?h.value&&_.value?s(r.value.id):t(r.value.id):""),A=o=>{const n=o.target;h.value&&_.value?(console.log("Real photo failed to load, updating state"),h.value=!1,_.value=!1,f.value=!0,r.value&&(n.src=t(r.value.id))):n.src="/artworks/placeholder.svg"},L=async o=>{if(o)try{p.value=!0,$.value="",r.value=null,h.value=!1,_.value=!1,f.value=!1;const n=String(o).split("&")[0],C=u.value,a=await fetch(`/locales/${C}/artworksIntro.json`);if(!a.ok)throw new Error("Failed to load artwork data");const k=(await a.json()).find(y=>String(y.id)===n);if(k){console.log(`Found artwork: ${k.title} (ID: ${k.id})`);const y=await i(k.id);_.value=y,f.value=!0,r.value=k,console.log(`Final state: hasRealPhoto=${_.value}, photoCheckCompleted=${f.value}`)}else $.value="Artwork not found"}catch(n){console.error("Error fetching artwork:",n),$.value="Failed to load artwork data"}finally{p.value=!1}},V=()=>{w("close")};return j(()=>g.artworkId,o=>{o&&g.isVisible&&L(o)}),j(()=>g.isVisible,o=>{o&&g.artworkId&&L(g.artworkId)}),j(u,async o=>{await P(o),g.artworkId&&g.isVisible&&L(g.artworkId)}),Q(async()=>{await P(u.value)}),(o,n)=>o.isVisible?(d(),c("div",{key:0,class:"artwork-modal-overlay",onClick:V},[e("div",{class:"artwork-modal",onClick:n[2]||(n[2]=O(()=>{},["stop"]))},[e("button",{class:"close-btn",onClick:V},n[3]||(n[3]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m18 6-12 12M6 6l12 12"})],-1)])),p.value?(d(),c("div",W,[n[4]||(n[4]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,l(o.$t("common.loading")||"Loading..."),1)])):$.value?(d(),c("div",Z,[e("h2",null,l(o.$t("common.error")||"Error"),1),e("p",null,l($.value),1)])):r.value?(d(),c("div",ee,[e("div",te,[e("img",{src:b.value,alt:r.value.title,onError:A,class:"artwork-img"},null,40,oe),!p.value&&f.value?(d(),c("div",se,[_.value?(d(),c(R,{key:0},[e("button",{onClick:n[0]||(n[0]=()=>{_.value&&(h.value=!1)}),class:F(["toggle-btn",{active:!h.value}])},l(o.$t("artwork.artworkView")||"藝術作品"),3),e("button",{onClick:n[1]||(n[1]=()=>{_.value&&(h.value=!0)}),class:F(["toggle-btn",{active:h.value}])},l(o.$t("artwork.realPhotoView")||"實景對比"),3)],64)):(d(),c("div",ae,l(o.$t("artwork.artworkView")||"藝術作品"),1))])):E("",!0)]),e("div",le,[e("h1",ie,l(r.value.title),1),e("div",ne,[e("div",re,[e("span",ce,l(o.$t("artwork.artist")||"Artist")+":",1),e("span",de,l(r.value.artist),1)]),e("div",ue,[e("span",ge,l(o.$t("artwork.year")||"Year")+":",1),e("span",ve,l(r.value.year),1)])]),e("div",ke,[e("h3",null,l(o.$t("artwork.description")||"Description"),1),e("div",we,[(d(!0),c(R,null,D(r.value.description,(C,a)=>(d(),c("p",{key:a},l(C),1))),128))])]),I.value?(d(),c("div",me,[e("p",pe,l(o.$t("artwork.multipleInfo")||"This location contains multiple artworks"),1)])):E("",!0)])])):E("",!0)])])):E("",!0)}}),_e=Y(he,[["__scopeId","data-v-bce2d184"]]),fe={key:0,class:"loading"},$e={key:1,class:"selector-content"},be={class:"selector-title"},ye={class:"selector-description"},Ie={class:"artwork-list"},Ce=["onClick"],Be={class:"artwork-thumbnail"},Me=["src","alt"],Se={class:"artwork-details"},Ae={class:"artwork-title"},Le={class:"artwork-meta"},Ve=T({__name:"ArtworkSelector",props:{isVisible:{type:Boolean,default:!1},artworkIds:{default:""}},emits:["close","select"],setup(z,{emit:M}){const{locale:u}=x(),g=z,w=M,r=m([]),p=m(!1),$=async t=>{try{const[s,i]=await Promise.all([fetch(`/locales/${t}/common.json`),fetch(`/locales/${t}/artwork.json`)]);if(s.ok&&i.ok){const[b,A]=await Promise.all([s.json(),i.json()]);N.global.setLocaleMessage(t,{...N.global.getLocaleMessage(t),common:b,artwork:A})}}catch(s){console.error("Failed to load locale messages:",s)}},h=t=>`/artworks/${String(t).padStart(2,"0")}.webp`,_=t=>{const s=t.target;s.src="/artworks/placeholder.svg"},f=async t=>{if(t)try{p.value=!0;const s=String(t).split("&"),i=u.value,b=await fetch(`/locales/${i}/artworksIntro.json`);if(!b.ok)throw new Error("Failed to load artwork data");const L=(await b.json()).filter(V=>s.includes(String(V.id)));r.value=s.map(V=>L.find(o=>String(o.id)===V)).filter(Boolean)}catch(s){console.error("Error fetching artworks:",s)}finally{p.value=!1}},P=t=>{w("select",String(t))},I=()=>{w("close")};return j(()=>g.artworkIds,t=>{t&&g.isVisible&&f(t)}),j(()=>g.isVisible,t=>{t&&g.artworkIds&&f(g.artworkIds)}),j(u,async t=>{await $(t),g.artworkIds&&g.isVisible&&f(g.artworkIds)}),Q(async()=>{await $(u.value)}),(t,s)=>t.isVisible?(d(),c("div",{key:0,class:"artwork-selector-overlay",onClick:I},[e("div",{class:"artwork-selector",onClick:s[0]||(s[0]=O(()=>{},["stop"]))},[e("button",{class:"close-btn",onClick:I},s[1]||(s[1]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m18 6-12 12M6 6l12 12"})],-1)])),p.value?(d(),c("div",fe,[s[2]||(s[2]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,l(t.$t("common.loading")||"Loading..."),1)])):(d(),c("div",$e,[e("h2",be,l(S(u)==="zh"?"選擇要查看的作品":"Select Artwork to View"),1),e("p",ye,l(S(u)==="zh"?"此位置有多個作品，請選擇您想要查看的作品：":"This location contains multiple artworks. Please select the one you want to view:"),1),e("div",Ie,[(d(!0),c(R,null,D(r.value,i=>(d(),c("div",{key:i.id,class:"artwork-item",onClick:b=>P(String(i.id))},[e("div",Be,[e("img",{src:h(i.id),alt:i.title,onError:_,class:"thumbnail-img"},null,40,Me)]),e("div",Se,[e("h3",Ae,l(i.title),1),e("p",Le,l(i.artist)+" · "+l(i.year),1)])],8,Ce))),128))])]))])])):E("",!0)}}),Pe=Y(Ve,[["__scopeId","data-v-abf92d97"]]),Ee={key:0,class:"building-artwork-selector"},je={class:"modal-container"},ze={class:"modal-header"},Re={class:"modal-title"},Fe={class:"artwork-count"},De={class:"modal-content"},Ne={key:0,class:"loading-state"},Te={key:1,class:"empty-state"},xe={key:2,class:"artwork-grid"},Qe=["onClick"],Ye={class:"artwork-image-container"},Ke=["src","alt"],Xe={class:"artwork-overlay"},He={class:"view-text"},Ge={class:"artwork-info"},Oe={class:"artwork-title"},Ue={class:"artwork-artist"},qe={class:"artwork-year"},Je=T({__name:"BuildingArtworkSelector",props:{isVisible:{type:Boolean},buildingLocation:{}},emits:["close","select"],setup(z,{emit:M}){const u=z,g=M,{locale:w}=x(),r=m([]),p=m(!1),$=t=>{const s=t.target;s&&(s.src="/artworks/placeholder.svg")},h=t=>{const s=Number(t),i=["勤益學舍","工業工程與管理館","青永館","文化休閒館","明秀湖","工程館","工具機學院大樓","機車停車場","行政大樓後方房舍","行政大樓","圖書資訊館","運動場","機械館","誠樸館","創新研發大樓","國秀樓","管理館","勤創基地","創辦人故居","其他"],b=["Qin-Yi Dormitory","Industrial Engineering and Management Building","Qing-Yong Building","Culture and Recreation Building","Ming-Xiu Lake","Engineering Building","Machine Tool Institute Building","Motorcycle Parking Lot","Administrative Building Rear Housing","Administrative Building","Library and Information Building","Sports Field","Mechanical Building","Cheng-Pu Building","Innovation and R&D Building","Guo-Xiu Building","Management Building","Qin-Chuang Base","Founder's Former Residence","Others"];return(w.value==="zh"?i:b)[s-1]||`${w.value==="zh"?"建築物":"Building"} ${t}`},_=t=>`/artworks/${String(t).padStart(2,"0")}.webp`,f=async t=>{if(t){p.value=!0;try{const s=w.value==="zh"?"/locales/zh/artworksIntro.json":"/locales/en/artworksIntro.json",i=await fetch(s);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const b=await i.json(),A=Number(t);r.value=b.filter(L=>L.location===A),console.log(`載入建築物 ${t} 的作品:`,r.value)}catch(s){console.error("載入作品資料失敗:",s),r.value=[]}finally{p.value=!1}}},P=t=>{g("select",String(t))},I=()=>{g("close")};return j(()=>u.buildingLocation,t=>{t&&u.isVisible&&f(t)},{immediate:!0}),j(()=>u.isVisible,t=>{t&&u.buildingLocation&&f(u.buildingLocation)}),Q(()=>{u.isVisible&&u.buildingLocation&&f(u.buildingLocation)}),(t,s)=>t.isVisible?(d(),c("div",Ee,[e("div",{class:"modal-backdrop",onClick:I}),e("div",je,[e("div",ze,[e("h2",Re,[U(l(h(t.buildingLocation))+" ",1),e("span",Fe," ("+l(S(w)==="zh"?"共":"Total")+" "+l(r.value.length)+" "+l(S(w)==="zh"?"件作品":"artworks")+") ",1)]),e("button",{class:"close-btn",onClick:I},"×")]),e("div",De,[p.value?(d(),c("div",Ne,[s[0]||(s[0]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,l(S(w)==="zh"?"載入中...":"Loading..."),1)])):r.value.length===0?(d(),c("div",Te,[e("p",null,l(S(w)==="zh"?"此建築物暫無相關作品":"No artworks found for this building"),1)])):(d(),c("div",xe,[(d(!0),c(R,null,D(r.value,i=>(d(),c("div",{key:i.id,class:"artwork-card",onClick:b=>P(i.id)},[e("div",Ye,[e("img",{src:_(i.id),alt:i.title,class:"artwork-image",loading:"lazy",onError:$},null,40,Ke),e("div",Xe,[e("span",He,l(S(w)==="zh"?"查看詳情":"View Details"),1)])]),e("div",Ge,[e("h3",Oe,l(i.title),1),e("p",Ue,l(i.artist),1),e("p",qe,l(i.year),1)])],8,Qe))),128))]))])])])):E("",!0)}}),We=Y(Je,[["__scopeId","data-v-e5727a8d"]]),Ze={class:"map-item"},et={class:"map-toggle"},tt={class:"map-container"},ot=["title","onClick"],st={key:0,class:"point-number"},at={key:0,class:"map-legend"},lt={class:"legend-title"},it={class:"legend-grid"},nt=["onClick"],rt=T({__name:"MapItem",setup(z){const{locale:M}=x(),u=m("building"),g=m(!1),w=m(!1),r=m(!1),p=m(""),$=m(""),h=m(""),_=m([]),f=["1.勤益學舍","2.工業工程與管理館","3.青永館","4.文化休閒館","5.明秀湖","6.工程館","7.工具機學院大樓","8.機車停車場","9.行政大樓後方房舍","10.行政大樓","11.圖書資訊館","12.運動場","13.機械館","14.誠樸館","15.創新研發大樓","16.國秀樓","17.管理館","18.勤創基地","19.創辦人故居","20.其他"],P=["1.Qin-Yi Dormitory","2.Industrial Engineering and Management Building","3.Qing-Yong Building","4.Culture and Recreation Building","5.Ming-Xiu Lake","6.Engineering Building","7.Machine Tool Institute Building","8.Motorcycle Parking Lot","9.Administrative Building Rear Housing","10.Administrative Building","11.Library and Information Building","12.Sports Field","13.Mechanical Building","14.Cheng-Pu Building","15.Innovation and R&D Building","16.Guo-Xiu Building","17.Management Building","18.Qin-Chuang Base","19.Founder's Former Residence","20.Others"],I=H(()=>M.value==="zh"?f:P),t=async(a=u.value)=>{try{const y=await(await fetch(a==="building"?"/buildingLocation.json":"/artworkLocation.json")).json();_.value=y.map((B,K)=>({id:`point-${K}`,x:B.x,y:B.y,label:B.keypointlabels[0]})),console.log(`載入的${a}關鍵點數據:`,_.value)}catch(v){console.error("載入關鍵點數據失敗:",v)}},s=async a=>{u.value=a,await t(a)},i=a=>({left:`${a.x}%`,top:`${a.y}%`}),b=a=>{var v;if(a.includes("&"))return a.split("&").map(B=>{var G;const K=parseInt(B.trim())-1;return((G=I.value[K])==null?void 0:G.replace(/^\d+\./,""))||B}).join(" & ");{const k=parseInt(a)-1;return((v=I.value[k])==null?void 0:v.replace(/^\d+\./,""))||a}},A=a=>{h.value=String(a),r.value=!0},L=a=>{if(u.value==="artwork"){const v=String(a.label);v.includes("&")?($.value=v,w.value=!0):(p.value=v,g.value=!0)}else h.value=String(a.label),r.value=!0},V=a=>{w.value=!1,p.value=String(a),g.value=!0},o=()=>{g.value=!1,p.value=""},n=()=>{w.value=!1,$.value=""},C=()=>{r.value=!1,h.value=""};return Q(()=>{t()}),(a,v)=>(d(),c("div",Ze,[e("div",et,[e("button",{class:F(["toggle-btn",{active:u.value==="building"}]),onClick:v[0]||(v[0]=k=>s("building"))},l(S(M)==="zh"?"地圖探索":"Campus Map"),3),e("button",{class:F(["toggle-btn",{active:u.value==="artwork"}]),onClick:v[1]||(v[1]=k=>s("artwork"))},l(S(M)==="zh"?"藝術家眼中的校景":"Campus Artworks"),3)]),e("div",tt,[v[2]||(v[2]=e("img",{src:J,alt:"Campus Map",class:"map-image"},null,-1)),(d(!0),c(R,null,D(_.value,k=>(d(),c("div",{key:k.id,class:F(["keypoint",u.value==="building"?"building-point":"artwork-point"]),style:q(i(k)),title:b(k.label),onClick:y=>L(k)},[u.value==="building"?(d(),c("span",st,l(k.label),1)):E("",!0)],14,ot))),128))]),u.value==="building"?(d(),c("div",at,[e("h3",lt,l(S(M)==="zh"?"校園地圖說明":"Campus Map Legend"),1),e("div",it,[(d(!0),c(R,null,D(I.value,(k,y)=>(d(),c("div",{key:y,class:"legend-item clickable",onClick:B=>A(y+1)},l(k),9,nt))),128))])])):E("",!0),X(We,{isVisible:r.value,buildingLocation:h.value,onClose:C,onSelect:V},null,8,["isVisible","buildingLocation"]),X(Pe,{isVisible:w.value,artworkIds:$.value,onClose:n,onSelect:V},null,8,["isVisible","artworkIds"]),X(_e,{isVisible:g.value,artworkId:p.value,onClose:o},null,8,["isVisible","artworkId"])]))}}),dt=Y(rt,[["__scopeId","data-v-5e9d1e90"]]);export{dt as default};
